# ZLoa History Tracker 사용 설명서

## 소개

ZLoa History Tracker는 zloa.net 사이트에서 캐릭터 조회 후 검색 결과를 파이어베이스 데이터베이스에 저장하는 크롬 확장 프로그램입니다. 환산점수 추적과 분석을 위한 도구입니다.

## 주요 기능

1. zloa.net에서 검색 결과에 '캐릭터 정보 저장' 버튼 추가
2. 캐릭터 정보, 환산점수, 아이템 레벨 등 데이터 자동 추출
3. 추출한 데이터를 파이어베이스 데이터베이스에 저장
4. 환산점수가 같은 경우 중복 저장 방지 (최적화 기능)
5. 환산점수 오류가 있는 경우 저장 차단 (데이터 품질 유지)
6. 로컬 캐시를 통한 성능 최적화 및 API 호출 감소

## 설치 방법

### 개발자 모드 설치

1. 이 저장소를 클론하거나 다운로드합니다.
2. 의존성을 설치합니다: `npm install`
3. `.env` 파일을 설정합니다 (Firebase 설정 포함)
4. 프로젝트를 빌드합니다: `npm run build`
5. Chrome 브라우저를 열고 `chrome://extensions`로 이동합니다.
6. 우측 상단의 "개발자 모드"를 활성화합니다.
7. "압축해제된 확장 프로그램을 로드합니다"를 클릭하고 생성된 `dist` 폴더를 선택합니다.

## 사용 방법

1. Chrome 확장 프로그램을 설치합니다.
2. zloa.net 웹사이트에 접속합니다.
3. 캐릭터를 검색합니다.
4. 검색 결과 페이지에 자동으로 추가된 "캐릭터 정보 저장" 버튼이 표시됩니다.
5. 버튼을 클릭하여 현재 캐릭터 정보를 저장합니다.
6. 상태 메시지를 통해 저장 결과를 확인합니다.

## 상태 메시지 색상 의미

- **녹색**: 데이터가 성공적으로 저장됨
- **주황색**: 이미 동일한 환산점수로 저장된 데이터가 있어 저장을 건너뜀
- **빨간색**: 오류 발생 (환산점수 오류, 접근 오류 등)

## 보안 및 속도 제한

확장 프로그램은 서버 부하를 줄이기 위해 다음과 같은 기능을 포함합니다:

1. **속도 제한**: 초당 최대 5회 요청으로 제한
2. **로컬 캐시**: 동일한 캐릭터 정보를 5분간 캐시하여 중복 요청 감소
3. **중복 저장 방지**: 환산점수가 변경되지 않은 경우 저장하지 않음
4. **보안 규칙**: Firebase에 특정 경로만 쓰기 허용하는 보안 규칙 적용

## 캐릭터 정보 추출 항목

* 캐릭터 이름
* 서버
* 환산 점수
* 아이템 레벨
* 클래스
* 빌드
* 계산된 시각
* 관측 시각
* 서포터 여부
* 환산 점수 영수증 데이터
* 장비 정보 (품질, 강화 수치)

## 파이어베이스 설정

1. 실제 배포 전 `.env` 파일에 유효한 파이어베이스 API 키와 설정을 입력해야 합니다.
2. `.env` 파일은 `.gitignore`에 포함되어 있어 GitHub에 업로드되지 않습니다.
3. 파이어베이스 보안 규칙을 적절히 설정하여 무단 접근을 방지합니다.

## 개발 정보

* 개발 언어: JavaScript
* 필요 도구: Node.js, npm
* 주요 의존성: Firebase
* 빌드 도구: Webpack

## 문제 해결

* **저장 버튼이 나타나지 않을 경우**: 페이지를 새로고침하거나 크롬 확장 프로그램을 재설치해보세요.
* **저장 실패 시**: 브라우저 콘솔을 확인하여 오류 메시지를 확인하세요.
* **파이어베이스 연결 실패**: `.env` 파일의 API 키와 설정이 올바른지 확인하세요.
* **"환산점수 오류" 메시지**: zloa.net에서 데이터 계산 중 오류가 발생한 상태입니다. 페이지를 새로고침하거나 나중에 다시 시도하세요.

## 데이터베이스 구조

```javascript
{
  "charname": "캐릭터이름",
  "server": "서버이름",
  "converted_zp": 1234.56,
  "zp_score": 1234.56,
  "temlv": 1680.0,
  "class": "클래스명",
  "build": "빌드이름",
  "calculated_at": "계산시각",
  "observed_at": "저장시각(ISO 형식)",
  "receipt": {
    "초월": 29.77,
    "장비": 52.88,
    // ... 기타 환산 점수 영수증 데이터
  }
}
```
